<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pantalla del DM: La Mina Perdida</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap');
        
        body {
            font-family: 'Lato', sans-serif;
            background-color: #1a1b1e;
            color: #e5e7eb;
            -webkit-tap-highlight-color: transparent; /* Elimina el flash azul en móviles */
        }
        h1, h2, h3, .fantasy-font {
            font-family: 'Cinzel', serif;
        }
        /* Scrollbar oculta para la navegación móvil */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scroll-custom::-webkit-scrollbar {
            width: 8px;
        }
        .scroll-custom::-webkit-scrollbar-track {
            background: #2d2d30;
        }
        .scroll-custom::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
        }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #eab308;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #eab308;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS SVG ---
        const IconBookOpen = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
        );
        const IconUsers = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
        );
        const IconShoppingBag = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
        );
        const IconSkull = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.5 2C8.91 2 6 4.91 6 8.5V9a6 6 0 1 0 12 0V8.5C18 4.91 15.09 2 12.5 2z"></path><path d="M10 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M14 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M9 19h6"></path><path d="M10 22h4"></path></svg>
        );
        const IconShield = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
        );
        const IconAlertTriangle = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
        );
        const IconChevronDown = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="6 9 12 15 18 9"></polyline></svg>
        );
        const IconChevronUp = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="18 15 12 9 6 15"></polyline></svg>
        );
        const IconX = ({ size = 24, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        );
        const IconInfo = ({ size = 16, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        );
        const IconGavel = ({ size = 20, className }) => (
             <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14 13l-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10"></path><path d="m16 16 6-6"></path><path d="m8 8 6-6"></path><path d="m9 7 8 8"></path><path d="m21 11-8-8"></path></svg>
        );

        // --- DATOS ---

        const rulesData = {
            mainActions: [
                { name: "Atacar", desc: "Haces un ataque cuerpo a cuerpo o a distancia." },
                { name: "Lanzar Hechizo", desc: "La mayoría de hechizos requieren una Acción." },
                { name: "Correr (Dash)", desc: "Doblas tu velocidad de movimiento por este turno." },
                { name: "Destrabarse (Disengage)", desc: "Tu movimiento no provoca ataques de oportunidad." },
                { name: "Esquivar (Dodge)", desc: "Ataques contra ti tienen Desventaja. Tus saves de DES tienen Ventaja." },
                { name: "Ayudar (Help)", desc: "Das Ventaja a un aliado en su próxima tirada." },
                { name: "Esconderse (Hide)", desc: "Haces un chequeo de Sigilo para ocultarte." },
                { name: "Preparar (Ready)", desc: "Retienes tu acción para usarla como Reacción." },
                { name: "Usar Objeto", desc: "Interactuar con objeto complejo (poción, palanca)." },
                { name: "Buscar", desc: "Dedicas tu atención a encontrar algo." }
            ],
            bonusActions: [
                { name: "Ataque mano torpe", desc: "Si usas dos armas ligeras, atacas con la segunda como Bonus." },
                { name: "Hechizos Rápidos", desc: "Ej. Paso Brumoso, Palabra de Curación." },
                { name: "Rasgos de Clase", desc: "Furia, Inspiración de Bardo, Acción Astuta." }
            ],
            bg3Differences: [
                { title: "Pociones", raw: "ACCIÓN completa para beberla.", bg3: "Acción Adicional en BG3." },
                { title: "Empujar (Shove)", raw: "Es un ATAQUE especial (Acción).", bg3: "Acción Adicional en BG3." },
                { title: "Saltar", raw: "Parte de tu movimiento (Gratis).", bg3: "Acción Adicional." },
                { title: "Lanzar Objetos", raw: "ACCIÓN (Arma improvisada 1d4).", bg3: "Acción basada en peso." },
                { title: "Cambiar Arma", raw: "1 interacción gratuita por turno.", bg3: "Libre desde inventario." }
            ]
        };

        const storyData = [
            {
                chapter: "Cap 1: Emboscada",
                summary: "La escolta de Gundren. Emboscada Goblin y Cueva Cragmaw.",
                keyEvents: [
                    "Camino: Emboscada (4 Goblins).",
                    "Rastro: Seguir huellas a la Cueva.",
                    "Cueva: Rescatar a Sildar Hallwinter.",
                    "Klarg: Líder osgo (tiene tesoro).",
                    "Revelación: Gundren en Castillo Cragmaw."
                ]
            },
            {
                chapter: "Cap 2: Phandalin",
                summary: "Llegada al pueblo y los Marcas Rojas.",
                keyEvents: [
                    "Entrega: Barthen paga 10po c/u.",
                    "Rumores: Marcas Rojas en Mansión Tresendar.",
                    "Mansión: Entrada secreta (Carp).",
                    "Nothic: Lee mentes, negocia con carne.",
                    "Vara de Vidrio: Iarno Albrek (traidor)."
                ]
            },
            {
                chapter: "Cap 3: La Telaraña",
                summary: "Búsqueda del Castillo Cragmaw.",
                keyEvents: [
                    "Reidoth (Árbol Trueno): Conoce ubicación.",
                    "Venomfang: Dragón Verde Joven (¡PELIGRO!).",
                    "Castillo Cragmaw: Rey Grol y Mapa.",
                    "Rescate: Salvar a Gundren."
                ]
            },
            {
                chapter: "Cap 4: Cueva Oleaje",
                summary: "La Mina Perdida y la Forja.",
                keyEvents: [
                    "Entrada: Cadáver de Tharden.",
                    "Espectador: Guardián loco de la Forja.",
                    "Mormesk: Espectro codicioso.",
                    "Araña Negra: Nezznar (Jefe Final).",
                    "Recompensa: 10% de la mina."
                ]
            }
        ];

        // DATOS DE CLASES (Resumidos para móvil)
        const classesData = [
            { 
                name: "Bárbaro", hitDie: "d12", 
                levels: {
                    1: [{name: "Furia (x2)", desc: "Bonus. Ventaja FUE. +2 Daño. Resistencia físico."}, {name: "Defensa s/Armadura", desc: "AC = 10 + Des + Con."}],
                    2: [{name: "Ataque Temerario", desc: "Ventaja al pegar, te pegan con ventaja."}, {name: "Sentido Peligro", desc: "Ventaja en Saves de DES."}],
                    3: [{name: "Senda Primaria", desc: "Berserker (Ataque extra con fatiga) o Tótem (Oso resiste todo)."}, {name: "Furia (x3)", desc: "3 usos."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Ataque Extra", desc: "Atacas 2 veces por acción."}, {name: "Movimiento +10", desc: "+10 pies velocidad."}]
                }
            },
            { 
                name: "Bardo", hitDie: "d8", 
                levels: {
                    1: [{name: "Inspiración (d6)", desc: "Bonus. Aliado suma d6 a d20."}, {name: "Conjuros", desc: "4 trucos, 4 nvl 1."}],
                    2: [{name: "Aprendiz de Mucho", desc: "+1/2 proficiencia en todo lo que no sabes."}, {name: "Canción Descanso", desc: "Curas +1d6 en descanso corto."}],
                    3: [{name: "Colegio", desc: "Valor (Combate) o Saber (Skills)."}, {name: "Expertise", desc: "x2 proficiencia en 2 skills."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Inspiración (d8)", desc: "Dado sube a d8. Recuperas en Short Rest."}, {name: "Conjuros Nvl 3", desc: "Patrón Hipnótico."}]
                }
            },
            { 
                name: "Clérigo", hitDie: "d8", 
                levels: {
                    1: [{name: "Dominio", desc: "Vida, Guerra, Luz... Hechizos extra."}, {name: "Conjuros", desc: "Preparas Nivel + SAB."}],
                    2: [{name: "Canalizar Divinidad", desc: "Expulsar MV o efecto de dominio."}],
                    3: [{name: "Conjuros Nvl 2", desc: "Arma Espiritual, Rest. Menor."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Destruir MV", desc: "MV de CR 1/2 mueren al ser expulsados."}, {name: "Conjuros Nvl 3", desc: "Revivir, Espíritus Guardianes."}]
                }
            },
            { 
                name: "Druida", hitDie: "d8", 
                levels: {
                    1: [{name: "Druídico", desc: "Idioma secreto."}, {name: "Conjuros", desc: "Preparas Nivel + SAB."}],
                    2: [{name: "Forma Salvaje", desc: "Transformarse en bestia (CR 1/4)."}, {name: "Círculo", desc: "Tierra (Magia) o Luna (Combate bestial)."}],
                    3: [{name: "Conjuros Nvl 2", desc: "Piel de Roble, Paso sin Rastro."}],
                    4: [{name: "Forma Salvaje (Agua)", desc: "Bestias que nadan (CR 1/2)."}, {name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Conjuros Nvl 3", desc: "Invocar Animales, Llamar al Rayo."}]
                }
            },
            { 
                name: "Guerrero", hitDie: "d10", 
                levels: {
                    1: [{name: "Estilo Combate", desc: "+2 Daño, +1 AC, o +2 Ataque arco."}, {name: "Tomar Aliento", desc: "Bonus. Curas 1d10+Nivel."}],
                    2: [{name: "Acción Súbita", desc: "1 Acción extra por descanso corto."}],
                    3: [{name: "Arquetipo", desc: "Campeón (Crít 19), Batalla (Maniobras), Eldritch (Magia)."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Ataque Extra", desc: "Atacas 2 veces por acción."}]
                }
            },
            { 
                name: "Monje", hitDie: "d8", 
                levels: {
                    1: [{name: "Defensa s/Armadura", desc: "AC = 10 + Des + Sab."}, {name: "Artes Marciales", desc: "Golpe extra como bonus."}],
                    2: [{name: "Ki", desc: "Paso del Viento, Paciencia, Ráfaga."}, {name: "Movimiento", desc: "+10 pies."}],
                    3: [{name: "Tradición", desc: "Mano Abierta, Sombra, Elementos."}, {name: "Desviar Proyectil", desc: "Reacción. Reduces daño flecha."}],
                    4: [{name: "Caída Lenta", desc: "Reduces daño caída."}, {name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Ataque Extra", desc: "Atacas 2 veces."}, {name: "Golpe Aturdidor", desc: "Gasta Ki para aturdir (Stun) enemigo."}]
                }
            },
            { 
                name: "Paladín", hitDie: "d10", 
                levels: {
                    1: [{name: "Sentido Divino", desc: "Detectas Mal/Bien."}, {name: "Imponer Manos", desc: "Pool de curación."}],
                    2: [{name: "Divine Smite", desc: "Gasta slot para daño radiante extra."}, {name: "Estilo Combate", desc: "Defensa, Duelo, etc."}],
                    3: [{name: "Salud Divina", desc: "Inmune enfermedad."}, {name: "Juramento", desc: "Devoción, Venganza, Antiguos."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Ataque Extra", desc: "Atacas 2 veces."}, {name: "Conjuros Nvl 2", desc: "Find Steed."}]
                }
            },
            { 
                name: "Pícaro", hitDie: "d8", 
                levels: {
                    1: [{name: "Ataque Furtivo", desc: "+1d6 daño con Ventaja/Aliado."}, {name: "Expertise", desc: "x2 proficiencia."}],
                    2: [{name: "Acción Astuta", desc: "Bonus: Correr, Destrabar, Esconder."}],
                    3: [{name: "Arquetipo", desc: "Ladrón, Asesino, Arcane Trickster."}, {name: "Furtivo (2d6)", desc: "+2d6 daño."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Esquiva Asombrosa", desc: "Reacción. Reduces daño a la mitad."}, {name: "Furtivo (3d6)", desc: "+3d6 daño."}]
                }
            },
            { 
                name: "Hechicero", hitDie: "d6", 
                levels: {
                    1: [{name: "Origen", desc: "Dracónico (+AC) o Salvaje."}, {name: "Conjuros", desc: "Magia innata."}],
                    2: [{name: "Fuente de Magia", desc: "Crear slots con puntos."}],
                    3: [{name: "Metamagia", desc: "Sutil, Gemelo, Potenciado."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Conjuros Nvl 3", desc: "BOLA DE FUEGO, Celeridad."}]
                }
            },
            { 
                name: "Brujo", hitDie: "d8", 
                levels: {
                    1: [{name: "Patrón", desc: "Archifey, Fiend, GOO."}, {name: "Magia Pacto", desc: "Slots recargan en Short Rest."}],
                    2: [{name: "Invocaciones", desc: "Poderes pasivos (ej. Visión Oscura)."}],
                    3: [{name: "Pacto", desc: "Cadena, Hoja, Tomo."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Slots Nvl 3", desc: "Todo se lanza a nivel 3."}, {name: "Invocación Extra", desc: "Una más."}]
                }
            },
            { 
                name: "Mago", hitDie: "d6", 
                levels: {
                    1: [{name: "Recuperación", desc: "Recupera slots en Short Rest."}, {name: "Libro", desc: "Necesitas libro para magias."}],
                    2: [{name: "Tradición", desc: "Evocación, Abjuración, Adivinación..."}],
                    3: [{name: "Conjuros Nvl 2", desc: "Paso Brumoso, Invisibilidad."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Conjuros Nvl 3", desc: "BOLA DE FUEGO, Contrahechizo."}]
                }
            },
            { 
                name: "Explorador", hitDie: "d10", 
                levels: {
                    1: [{name: "Enemigo Pred.", desc: "Ventaja rastrear tipo enemigo."}, {name: "Explorador Nat.", desc: "Experto terreno."}],
                    2: [{name: "Estilo Combate", desc: "Arqueria, Dos armas."}, {name: "Conjuros", desc: "Marca del Cazador."}],
                    3: [{name: "Arquetipo", desc: "Cazador (Daño) o Bestias (Mascota)."}, {name: "Sentido Prim.", desc: "Detectar monstruos."}],
                    4: [{name: "Mejora Stat/Dote", desc: "+2 Stat o Dote."}],
                    5: [{name: "Ataque Extra", desc: "Atacas 2 veces."}, {name: "Conjuros Nvl 2", desc: "Pass without Trace."}]
                }
            }
        ];

        const shopsData = {
            "Suministros Barthen": {
                desc: "Tienda general. Equipo básico.",
                owner: "Elmar Barthen (50s, amable)",
                items: [
                    { name: "Mochila", cost: "2 po" },
                    { name: "Saco dormir", cost: "1 po" },
                    { name: "Raciones (1d)", cost: "5 pp" },
                    { name: "Cuerda (15m)", cost: "1 po" },
                    { name: "Antorcha", cost: "1 pc" },
                    { name: "Kit Sanador", cost: "5 po" }
                ]
            },
            "Escudo de León": {
                desc: "Armas y Armaduras.",
                owner: "Linene Graywind (30s, seria)",
                items: [
                    { name: "Espada Larga", cost: "15 po" },
                    { name: "Espada Corta", cost: "10 po" },
                    { name: "Hacha Batalla", cost: "10 po" },
                    { name: "Arco Largo", cost: "50 po" },
                    { name: "Caldearmaduras", cost: "50 po" },
                    { name: "Escudo (+2 AC)", cost: "10 po" },
                    { name: "Flechas (20)", cost: "1 po" }
                ]
            },
            "Posada Stonehill": {
                desc: "Comida y rumores.",
                owner: "Toblen Stonehill (Joven)",
                items: [
                    { name: "Estancia Mod.", cost: "5 pp" },
                    { name: "Estancia Cóm.", cost: "8 pp" },
                    { name: "Comida", cost: "3 pp" },
                    { name: "Cerveza", cost: "4 pc" }
                ]
            },
            "Loot Especial": {
                desc: "Objetos mágicos hallados.",
                owner: "Botín de aventura",
                items: [
                    { name: "Poción Curación", cost: "50 po", notes: "2d4+2 HP" },
                    { name: "Pergamino: Dormir", cost: "1 uso", notes: "Duerme 5d8 HP (Sin save)." },
                    { name: "Pergamino: Misil Mágico", cost: "1 uso", notes: "3x 1d4+1 daño seguro." },
                    { name: "Pergamino: Escudo", cost: "1 uso", notes: "+5 AC (Reacción)." },
                    { name: "Pergamino: Detectar Magia", cost: "1 uso", notes: "10 min. ves auras." },
                    { name: "Bastón Defensa", cost: "Raro", notes: "+1 AC. Magia." },
                    { name: "Talon (+1)", cost: "Rara", notes: "Espada plata." },
                    { name: "Guanteletes Ogro", cost: "Infr.", notes: "FUE 19." }
                ]
            }
        };

        const monstersData = [
            {
                chapter: "Cap 1: Goblins",
                mobs: [
                    { name: "Goblin", hp: "7 (2d6)", ac: 15, atk: "+4 (1d6+2)", notes: "Bonus: Esconder/Destrabar.", tactic3: "Usa 3 max. Cuidado flechas." },
                    { name: "Lobo", hp: "11 (2d8+2)", ac: 13, atk: "+4 (2d4+2)", notes: "Derribo (STR 11).", tactic3: "Encadenados al inicio." },
                    { name: "Klarg (Bugbear)", hp: "27 (5d8+5)", ac: 16, atk: "+6 (2d8+2)", notes: "Sorpresa: +2d6 daño.", tactic3: "Borracho (Desventaja)." }
                ]
            },
            {
                chapter: "Cap 2: Rufianes",
                mobs: [
                    { name: "Marca Roja", hp: "16 (3d8+3)", ac: 14, atk: "+4 (1d6+2)", notes: "Multiataque (2 golpes).", tactic3: "Quitar Multiataque." },
                    { name: "Nothic", hp: "45 (6d8+18)", ac: 15, atk: "+4 (1d6+3)", notes: "Mirada Necrótica (CON 12).", tactic3: "Social. Negocia secretos." },
                    { name: "Esqueleto", hp: "13 (2d8+4)", ac: 13, atk: "+4 (1d6+2)", notes: "Vuln. Contundente.", tactic3: "Estándar." },
                    { name: "Iarno (Mago)", hp: "22 (5d8)", ac: "12 (15)", atk: "+3", notes: "Escudo (+5 AC), Misil Mágico.", tactic3: "Huye al recibir daño." }
                ]
            },
            {
                chapter: "Cap 3 & 4",
                mobs: [
                    { name: "Hobgoblin", hp: "11 (2d8+2)", ac: 18, atk: "+3 (1d8+1)", notes: "Ventaja Marcial (+2d6).", tactic3: "AC 18 es muy alta." },
                    { name: "Oso Lechuza", hp: "59 (7d10+21)", ac: 13, atk: "+7 (1d10+5)", notes: "Multiataque. Muy fuerte.", tactic3: "TPK posible. Huir." },
                    { name: "Venomfang", hp: "136", ac: 19, atk: "Aliento", notes: "12d6 Veneno.", tactic3: "NO PELEAR. Social." },
                    { name: "Araña Gig.", hp: "26", ac: 14, atk: "+5 (1d8+3)", notes: "Veneno y Telaraña.", tactic3: "Molesta pero ok." }
                ]
            }
        ];

        // --- COMPONENTES UI ---

        const Modal = ({ title, content, onClose }) => {
            if (!title) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay animate-fade-in" onClick={onClose}>
                    <div className="bg-gray-800 rounded-lg shadow-2xl border border-yellow-600 w-full max-w-md p-6 relative max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-3 right-3 text-gray-400 hover:text-white p-2">
                            <IconX size={24} />
                        </button>
                        <h3 className="text-xl font-bold text-yellow-500 fantasy-font mb-4 flex items-center gap-2 pr-8">
                            <IconInfo size={24} className="shrink-0" />
                            {title}
                        </h3>
                        <p className="text-gray-200 leading-relaxed text-base">
                            {content}
                        </p>
                        <div className="mt-6 text-center">
                            <button onClick={onClose} className="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-8 rounded-full transition-colors w-full md:w-auto shadow-lg active:scale-95 transform transition">
                                Entendido
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const TabButton = ({ active, onClick, icon: Icon, label }) => (
            <button
                onClick={onClick}
                className={`flex-shrink-0 flex items-center gap-2 px-4 py-3 min-w-[max-content] transition-all duration-200 border-b-2 select-none ${
                    active 
                    ? 'border-yellow-500 text-yellow-500 bg-gray-800' 
                    : 'border-transparent text-gray-400 hover:text-gray-200'
                }`}
            >
                <Icon size={18} />
                <span className="font-bold text-sm md:text-base">{label}</span>
            </button>
        );

        const SectionCard = ({ title, children, color = "border-l-4 border-blue-500" }) => (
            <div className={`bg-gray-800 rounded-lg p-4 mb-4 shadow-lg ${color}`}>
                <h3 className="text-lg md:text-xl font-bold mb-2 text-white fantasy-font">{title}</h3>
                <div className="text-gray-300 text-sm md:text-base">
                    {children}
                </div>
            </div>
        );

        const Accordion = ({ title, sub, children }) => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="bg-gray-800 rounded mb-2 overflow-hidden border border-gray-700">
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-full px-4 py-3 flex justify-between items-center bg-gray-750 hover:bg-gray-700 active:bg-gray-700 transition-colors text-left"
                    >
                        <div className="flex-1">
                            <span className="font-bold text-yellow-500 block md:inline">{title}</span>
                            <span className="text-xs md:text-sm text-gray-400 md:ml-2 block md:inline">({sub})</span>
                        </div>
                        {isOpen ? <IconChevronUp size={20} /> : <IconChevronDown size={20} />}
                    </button>
                    {isOpen && (
                        <div className="p-3 md:p-4 bg-gray-800 border-t border-gray-700 text-sm">
                            {children}
                        </div>
                    )}
                </div>
            );
        };

        const FeatureButton = ({ name, desc, onOpenModal }) => (
            <button 
                onClick={() => onOpenModal(name, desc)}
                className="text-left bg-gray-700/50 hover:bg-gray-600 border border-gray-600 hover:border-yellow-500 rounded px-3 py-3 transition-all w-full mb-2 flex items-center justify-between group active:scale-[0.99]"
            >
                <span className="font-bold text-gray-200 text-sm group-hover:text-yellow-400 pr-2">{name}</span>
                <IconInfo size={16} className="text-gray-500 shrink-0 group-hover:text-yellow-500" />
            </button>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('classes');
            const [selectedShop, setSelectedShop] = useState("Suministros Barthen");
            const [modalInfo, setModalInfo] = useState({ title: null, content: null });
            const [numPlayers, setNumPlayers] = useState(3);

            const openModal = (title, content) => {
                setModalInfo({ title, content });
            };

            const closeModal = () => {
                setModalInfo({ title: null, content: null });
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-200 pb-20 md:pb-10 relative">
                    <Modal title={modalInfo.title} content={modalInfo.content} onClose={closeModal} />

                    {/* Header Compacto */}
                    <header className="bg-gray-900 border-b border-gray-700 p-4 md:p-6 text-center">
                        <h1 className="text-xl md:text-4xl font-bold text-yellow-500 mb-1">Mina Perdida</h1>
                        <p className="text-xs md:text-base text-gray-400 italic">DM Tool - {numPlayers} Jugadores</p>
                    </header>

                    {/* Navigation Mobile Scrollable */}
                    <nav className="sticky top-0 z-20 bg-gray-900/95 backdrop-blur border-b border-gray-700 shadow-lg">
                        <div className="flex overflow-x-auto hide-scrollbar md:justify-center">
                            <TabButton active={activeTab === 'story'} onClick={() => setActiveTab('story')} icon={IconBookOpen} label="Historia" />
                            <TabButton active={activeTab === 'rules'} onClick={() => setActiveTab('rules')} icon={IconGavel} label="Reglas" />
                            <TabButton active={activeTab === 'classes'} onClick={() => setActiveTab('classes')} icon={IconUsers} label="Clases" />
                            <TabButton active={activeTab === 'shops'} onClick={() => setActiveTab('shops')} icon={IconShoppingBag} label="Tiendas" />
                            <TabButton active={activeTab === 'monsters'} onClick={() => setActiveTab('monsters')} icon={IconSkull} label="Bestiario" />
                        </div>
                    </nav>

                    {/* Content */}
                    <main className="container mx-auto p-3 md:p-6 max-w-4xl">
                        
                        {/* TAB: HISTORIA */}
                        {activeTab === 'story' && (
                            <div className="animate-fade-in pb-10">
                                {storyData.map((chapter, idx) => (
                                    <SectionCard key={idx} title={chapter.chapter} color="border-l-4 border-yellow-600">
                                        <p className="mb-3 italic text-gray-400 text-sm">{chapter.summary}</p>
                                        <ul className="space-y-3">
                                            {chapter.keyEvents.map((event, i) => (
                                                <li key={i} className="flex gap-2 items-start text-sm md:text-base">
                                                    <span className="text-yellow-500 mt-0.5">➤</span>
                                                    <span>{event}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </SectionCard>
                                ))}
                            </div>
                        )}

                        {/* TAB: REGLAS & ACCIONES */}
                        {activeTab === 'rules' && (
                            <div className="animate-fade-in space-y-4 pb-10">
                                {/* Diferencias BG3 */}
                                <div className="bg-gray-800 rounded border border-gray-700 p-4">
                                    <h3 className="text-lg font-bold text-purple-400 mb-3 flex items-center gap-2">
                                        <span className="text-xl">⚡</span> BG3 vs Mesa
                                    </h3>
                                    <div className="grid gap-3">
                                        {rulesData.bg3Differences.map((rule, idx) => (
                                            <div key={idx} className="bg-gray-900 p-3 rounded border-l-4 border-purple-500">
                                                <h4 className="font-bold text-white mb-1 text-sm">{rule.title}</h4>
                                                <div className="text-xs md:text-sm grid grid-cols-1 gap-1">
                                                    <p><span className="text-green-400 font-bold">Mesa:</span> <span className="text-gray-300">{rule.raw}</span></p>
                                                    <p><span className="text-purple-400 font-bold">BG3:</span> <span className="text-gray-400">{rule.bg3}</span></p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4">
                                    {/* Acciones */}
                                    <div>
                                        <h3 className="text-lg font-bold text-green-500 mb-2 border-b border-gray-700 pb-1">ACCIÓN (1)</h3>
                                        <div className="space-y-1">
                                            {rulesData.mainActions.map((act, idx) => (
                                                <div key={idx} className="bg-gray-800 p-2 rounded border border-gray-700/50">
                                                    <strong className="text-gray-200 text-sm block">{act.name}</strong>
                                                    <span className="text-xs text-gray-400">{act.desc}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Bonus & Reacciones */}
                                    <div className="space-y-4">
                                        <div>
                                            <h3 className="text-lg font-bold text-yellow-500 mb-2 border-b border-gray-700 pb-1">BONUS (Max 1)</h3>
                                            <div className="space-y-1">
                                                {rulesData.bonusActions.map((act, idx) => (
                                                    <div key={idx} className="bg-gray-800 p-2 rounded border border-gray-700/50">
                                                        <strong className="text-gray-200 text-sm block">{act.name}</strong>
                                                        <span className="text-xs text-gray-400">{act.desc}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-bold text-blue-500 mb-2 border-b border-gray-700 pb-1">REACCIÓN (Max 1)</h3>
                                            <div className="bg-gray-800 p-2 rounded border border-gray-700/50 mb-1">
                                                <strong className="text-gray-200 text-sm block">Ataque Oportunidad</strong>
                                                <span className="text-xs text-gray-400">Enemigo sale de alcance.</span>
                                            </div>
                                            <div className="bg-gray-800 p-2 rounded border border-gray-700/50">
                                                <strong className="text-gray-200 text-sm block">Acción Preparada</strong>
                                                <span className="text-xs text-gray-400">Tu trigger se cumple.</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB: CLASES */}
                        {activeTab === 'classes' && (
                            <div className="animate-fade-in pb-10">
                                <div className="bg-blue-900/30 p-3 rounded mb-4 border border-blue-500/50 flex gap-3 items-center">
                                    <IconAlertTriangle className="text-blue-400 shrink-0" size={20} />
                                    <p className="text-xs text-blue-100">
                                        <strong>Tip:</strong> Toca las habilidades para ver detalles. Incluye Nivel 5.
                                    </p>
                                </div>
                                <div className="grid gap-2">
                                    {classesData.map((cls, idx) => (
                                        <Accordion key={idx} title={cls.name} sub={cls.hitDie}>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                {[1, 2, 3, 4, 5].map(lvl => (
                                                    <div key={lvl} className="bg-gray-900/50 p-2 rounded">
                                                        <strong className={`block mb-2 text-sm border-b border-gray-700 pb-1 ${lvl === 5 ? 'text-red-500' : 'text-yellow-500'}`}>Nivel {lvl}</strong>
                                                        {cls.levels[lvl].map((feat, fIdx) => (
                                                            <FeatureButton 
                                                                key={fIdx} 
                                                                name={feat.name} 
                                                                desc={feat.desc} 
                                                                onOpenModal={openModal} 
                                                            />
                                                        ))}
                                                    </div>
                                                ))}
                                            </div>
                                        </Accordion>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* TAB: TIENDAS */}
                        {activeTab === 'shops' && (
                            <div className="animate-fade-in pb-10">
                                <div className="flex overflow-x-auto hide-scrollbar gap-2 mb-4 pb-2">
                                    {Object.keys(shopsData).map(shop => (
                                        <button
                                            key={shop}
                                            onClick={() => setSelectedShop(shop)}
                                            className={`px-4 py-2 rounded-full text-sm font-bold border transition-colors whitespace-nowrap ${
                                                selectedShop === shop 
                                                ? 'bg-yellow-600 border-yellow-600 text-white' 
                                                : 'bg-gray-800 border-gray-600 text-gray-400'
                                            }`}
                                        >
                                            {shop}
                                        </button>
                                    ))}
                                </div>

                                <div className="bg-gray-800 rounded-lg p-4 md:p-6 border border-gray-700 shadow-xl">
                                    <h3 className="text-xl font-bold text-yellow-500 fantasy-font mb-1">{selectedShop}</h3>
                                    <p className="text-gray-400 mb-2 italic text-xs">{shopsData[selectedShop].owner}</p>
                                    <p className="text-gray-300 mb-4 text-sm border-b border-gray-700 pb-2">{shopsData[selectedShop].desc}</p>

                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left min-w-[300px]">
                                            <thead>
                                                <tr className="text-gray-500 border-b border-gray-700 text-sm">
                                                    <th className="py-2 pl-2">Objeto</th>
                                                    <th className="py-2 pr-2 text-right">Precio</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {shopsData[selectedShop].items.map((item, i) => (
                                                    <tr key={i} className="border-b border-gray-700/50 hover:bg-gray-700/30 text-sm">
                                                        <td className="py-3 pl-2">
                                                            <span className="font-bold text-gray-200 block">{item.name}</span>
                                                            {item.notes && <div className="text-xs text-blue-400 mt-0.5">{item.notes}</div>}
                                                        </td>
                                                        <td className="py-3 pr-2 text-right font-mono text-yellow-600 whitespace-nowrap">{item.cost}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB: MONSTRUOS */}
                        {activeTab === 'monsters' && (
                            <div className="animate-fade-in grid gap-4 pb-10">
                                {/* Controles Jugadores */}
                                <div className="bg-gray-800 p-3 rounded border border-gray-700 flex flex-row items-center justify-between sticky top-[60px] z-10 shadow-md">
                                    <div className="flex gap-2 items-center">
                                        <IconShield className={`${numPlayers === 3 ? 'text-red-400' : 'text-green-400'} shrink-0`} size={24} />
                                        <div>
                                            <h4 className={`font-bold text-sm ${numPlayers === 3 ? 'text-red-400' : 'text-green-400'}`}>
                                                {numPlayers} Jugadores
                                            </h4>
                                        </div>
                                    </div>
                                    
                                    {/* TOGGLE */}
                                    <div className="flex items-center gap-2">
                                        <span className={`text-xs font-bold ${numPlayers === 3 ? 'text-white' : 'text-gray-500'}`}>3</span>
                                        <div className="relative inline-block w-10 align-middle select-none transition duration-200 ease-in">
                                            <input 
                                                type="checkbox" 
                                                name="toggle" 
                                                id="player-toggle" 
                                                className="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300"
                                                checked={numPlayers === 4}
                                                onChange={() => setNumPlayers(numPlayers === 3 ? 4 : 3)}
                                                style={{left: numPlayers === 4 ? '1.25rem' : '0', borderColor: numPlayers === 4 ? '#22c55e' : '#f87171'}}
                                            />
                                            <label 
                                                htmlFor="player-toggle" 
                                                className={`toggle-label block overflow-hidden h-5 rounded-full cursor-pointer border border-gray-600 ${numPlayers === 4 ? 'bg-green-900' : 'bg-red-900'}`}
                                            ></label>
                                        </div>
                                        <span className={`text-xs font-bold ${numPlayers === 4 ? 'text-white' : 'text-gray-500'}`}>4</span>
                                    </div>
                                </div>

                                {monstersData.map((section, idx) => (
                                    <div key={idx}>
                                        <h3 className="text-lg font-bold text-yellow-500 mb-2 border-b border-gray-700 pb-1">{section.chapter}</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {section.mobs.map((mob, mIdx) => (
                                                <div key={mIdx} className="bg-gray-800 rounded p-3 border border-gray-700 relative overflow-hidden group">
                                                    <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                                                        <IconSkull size={50} />
                                                    </div>
                                                    <div className="flex justify-between items-start mb-1 relative z-10">
                                                        <h4 className="text-base font-bold text-white">{mob.name}</h4>
                                                        <div className="text-right flex gap-1">
                                                            <div className="bg-gray-700 px-1.5 py-0.5 rounded text-[10px] text-yellow-400 font-mono">AC:{mob.ac}</div>
                                                            <div className="bg-gray-700 px-1.5 py-0.5 rounded text-[10px] text-green-400 font-mono">HP:{mob.hp}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="space-y-1 text-sm relative z-10">
                                                        <p className="text-xs"><span className="text-gray-500">Atk:</span> <span className="text-gray-300">{mob.atk}</span></p>
                                                        <p className="text-xs text-gray-400 italic border-l-2 border-gray-600 pl-2">{mob.notes}</p>
                                                        
                                                        <div className={`mt-2 pt-1 border-t ${numPlayers === 3 ? 'border-red-900' : 'border-green-900'}`}>
                                                            <p className={`text-[10px] font-bold flex items-center gap-1 ${numPlayers === 3 ? 'text-red-400' : 'text-green-400'}`}>
                                                                <IconUsers size={10} /> Táctica:
                                                            </p>
                                                            <p className="text-xs text-gray-300">
                                                                {numPlayers === 3 
                                                                    ? mob.tactic3 
                                                                    : "Estándar (Libro)."}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
